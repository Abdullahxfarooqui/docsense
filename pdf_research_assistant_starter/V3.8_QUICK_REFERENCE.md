# 🚨 V3.8 Zero-Prose Enforcement - Quick Reference

## ⚡ One-Sentence Summary
**V3.8 eliminates ALL analytical text and enforces deterministic, table-only output for entity/numeric queries.**

---

## 🎯 What Changed

| Component | Change |
|-----------|--------|
| **Numeric Triggers** | Expanded to catch "show all parameters", "for each entity", "list data" |
| **System Prompt** | Complete rewrite - ZERO-PROSE ENFORCEMENT at top |
| **Output Format** | Wide entity table (one row per entity with all parameters) |
| **Missing Values** | Always "—" (never NULL, N/A, 0) |
| **First Character** | MUST be "\|" (pipe) - no text before table |
| **Entity Names** | Real names only (TAIMUR, LPG, not Source 1/2) |
| **Parameters** | Numeric + Text (Pressure + Product/Type/Sales Code/Ticket) |

---

## ✅ Expected Output Format

```markdown
| Entity | Pressure | Temperature | Volume | Type | Sales Code | Ticket | Notes |
|--------|----------|-------------|--------|------|------------|--------|-------|
| TAIMUR | 327.07 psig | 301.911 °F | 327.07 bbl | OIL | 5515 | 77826136 | Explicit |
| CONDEN | 0 psig | — | 0 bbl | CONDEN | ####### | f7f6faf7f | Explicit |
| LPG | 0 psig | 302 °F | 301.925 bbl | LPG | — | 4084bd2 | Explicit |
```

**Key Points:**
- First character is "|"
- Real entity names (TAIMUR, LPG, CONDEN)
- All numeric parameters (Pressure, Temperature, Volume)
- All text parameters (Type, Sales Code, Ticket)
- Missing values show "—"
- Units in cell (psig, °F, bbl)
- One row per entity

---

## 🚫 What's Prohibited

**NEVER:**
- Write "Introduction", "Key Insights", "Summary", "Conclusion"
- Use "Source 1/2/3", "Sheet1/2", "Entity A/B"
- Add text before table ("Based on the document...")
- Add text after table (except ONE calculation line if requested)
- Analyze or interpret ("TAIMUR has higher pressure...")
- Use NULL, N/A, or "Not found" for missing values
- Skip text parameters (Product, Type, Sales Code, Ticket)

---

## 🔍 Quick Verification

**Before accepting output, check:**
- [ ] First character is "|" or "["
- [ ] Using real names (TAIMUR, not Source 1)
- [ ] Includes text columns (Product, Type, Sales Code, Ticket)
- [ ] Missing values show "—" (not NULL)
- [ ] No prose before or after table
- [ ] One row per entity (duplicates merged)

---

## 🧪 Quick Tests

### **Test 1: Basic Entity Extraction**
```
Query: "Show all parameters for each entity"
Expected: Immediate table with TAIMUR, LPG, CONDEN rows
```

### **Test 2: Text Parameters**
```
Query: "Extract all data"
Expected: Table includes Product, Type, Sales Code, Ticket columns
```

### **Test 3: Missing Values**
```
Document: TAIMUR has Pressure but no Temperature
Expected: Temperature shows "—" (not NULL or 0)
```

### **Test 4: Zero Prose**
```
Check: First character of response is "|"
Check: NO text before or after table
```

---

## 🐛 Quick Troubleshooting

| Problem | Solution |
|---------|----------|
| **Prose before table** | Check if numeric mode triggered (log: "📊 NUMERIC") |
| **"Source 1/2/3" names** | Ensure entity extraction active (log: "🔍 Applying entity-based extraction...") |
| **Missing text params** | Check PARAMETER_PATTERNS in entity_extractor.py |
| **"NULL" instead of "—"** | Update system prompt missing value handling |
| **Not triggering numeric mode** | Add query pattern to detect_data_type() line 256 |

---

## 📂 Files Modified

**document_mode.py:**
- Lines 256-273: Expanded numeric triggers
- Lines 832-916: Zero-prose enforcement system prompt
- Lines 917-945: Entity-based output formats
- Lines 951-1012: Enhanced extraction protocol

**New Documentation:**
- V3.8_ZERO_PROSE_ENFORCEMENT.md (full guide)
- V3.8_QUICK_REFERENCE.md (this file)

---

## 🚀 Usage

**Query Patterns That Trigger Numeric Mode:**
- "show all parameters"
- "list all parameters"
- "parameters for each entity"
- "for each entity"
- "all entities"
- "extract all data"
- "show data"
- "values from document"
- "at each location"
- "in a table"

**Expected Response:**
- Starts with "|" (pipe)
- Entity-based table
- NO prose

---

## 📊 V3.7 vs V3.8 Quick Comparison

| Feature | V3.7 | V3.8 |
|---------|------|------|
| Prose | Sometimes | **NEVER** |
| First Char | Variable | **"\|"** |
| Text Params | Sometimes | **MANDATORY** |
| Missing Values | NULL/N/A | **"—"** |
| Entity Names | Mixed | **Real Only** |

---

**Status**: ✅ V3.8 Active  
**Purpose**: Zero prose, table-only output  
**Test**: Query "Show all parameters for each entity" → Expect immediate table
